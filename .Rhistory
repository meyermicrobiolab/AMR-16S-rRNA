p<-p+geom_point(size=3)+
theme(axis.title = element_text(size=14))+
theme(axis.text=element_text(size=12))+
theme(legend.title = element_text(size=14))+
theme(legend.text = element_text(size=12))+
scale_shape_manual(values=c(21,22))+
scale_fill_manual(values=cols)+
guides(fill = guide_legend(override.aes=list(shape=21)))+
facet_grid(~samples$fraction)
p + labs(x=xlab, y=ylab, fill="Type",shape="Fraction") +coord_fixed()
#dev.off()
####### Use phyloseq/vegan to perform PERMANOVA
# set metadata as factors
type<-as.character(samples$type)
frac<-as.character(samples$fraction)
# permanova between groups using Aitchison distance
dist.clr <- dist(E.clr)
perm<-adonis2(dist.clr~type*frac,as(sample_data(ps),"data.frame"),by="terms")
print(perm)
# Fraction is significant (R2=0.14679, p<0.001), while type is significant only at the p=0.05 level (R2=0.07314) but I prefer to use p=0.01 as the cutoff.
# load in data and create phyloseq object
otu <- read.table("silva_nochloronomito_otu_table_ps5.txt",sep="\t",header=TRUE, row.names=1)
taxon <- read.table("silva_nochloronomito_taxa_table_ps5.txt",sep="\t",header=TRUE,row.names=1)
samples<-read.table("metadata_ps5.txt",sep="\t",header=T,row.names=1)
OTU = otu_table(otu, taxa_are_rows=FALSE)
taxon<-as.matrix(taxon)
TAX = tax_table(taxon)
sampledata = sample_data(samples)
ps <- phyloseq(otu_table(otu, taxa_are_rows=FALSE),
sample_data(samples),
tax_table(taxon))
ps #112 taxa and 35 samples
# First, replace 0 values with an estimate (because normalization is taking log, can't have 0)
# Also transposing here, need samples as rows
d.czm <- cmultRepl(t(otu), method="CZM", label=0, z.warning=1)
# Perform the center-log-ratio (CLR) transformation
d.clr <- codaSeq.clr(d.czm)
# transpose matrix of CLR transformed data for ordination and dendrogram
E.clr <- t(d.clr)
# plot compositional PCA biplot (perform a singular value decomposition)
d.pcx <- prcomp(E.clr)
# calculate percent variance explained for the axis labels
pc1 <- round(d.pcx$sdev[1]^2/sum(d.pcx$sdev^2),2)
pc2 <- round(d.pcx$sdev[2]^2/sum(d.pcx$sdev^2),2)
xlab <- paste("PC1: ", pc1, sep="")
ylab <- paste("PC2: ", pc2, sep="")
#biplot(d.pcx, cex=c(0.6,0.4), var.axes=F,scale=1, xlab=xlab, ylab=ylab)
summary(d.pcx)
str(d.pcx)
screeplot(d.pcx)
# Make a pretty PCA plot with ggplot
df_out <- as.data.frame(d.pcx$x)
theme_set(theme_bw()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank()))
cols<-c("before"="#6CD5D9","after"="#107A86")
samples$type<-factor(samples$type, levels=c("before","after"))
#pdf("PCA.pdf",bg ="white",width=8.5)
p<-ggplot(df_out,aes(x=PC1,y=PC2,fill=samples$type,shape=samples$fraction))
p<-p+geom_point(size=3)+
theme(axis.title = element_text(size=14))+
theme(axis.text=element_text(size=12))+
theme(legend.title = element_text(size=14))+
theme(legend.text = element_text(size=12))+
scale_shape_manual(values=c(21,22))+
scale_fill_manual(values=cols)+
guides(fill = guide_legend(override.aes=list(shape=21)))+
facet_grid(~samples$fraction)
p + labs(x=xlab, y=ylab, fill="Type",shape="Fraction") +coord_fixed()
#dev.off()
####### Use phyloseq/vegan to perform PERMANOVA
# set metadata as factors
type<-as.character(samples$type)
frac<-as.character(samples$fraction)
# permanova between groups using Aitchison distance
dist.clr <- dist(E.clr)
perm<-adonis2(dist.clr~type*frac,as(sample_data(ps),"data.frame"),by="terms")
#print(perm)
print(perm)
# load in data and create phyloseq object
otu <- read.table("silva_nochloronomito_otu_table_ps5.txt",sep="\t",header=TRUE, row.names=1)
taxon <- read.table("silva_nochloronomito_taxa_table_ps5.txt",sep="\t",header=TRUE,row.names=1)
samples<-read.table("metadata_ps5.txt",sep="\t",header=T,row.names=1)
OTU = otu_table(otu, taxa_are_rows=FALSE)
taxon<-as.matrix(taxon)
TAX = tax_table(taxon)
sampledata = sample_data(samples)
ps <- phyloseq(otu_table(otu, taxa_are_rows=FALSE),
sample_data(samples),
tax_table(taxon))
ps #112 taxa and 35 samples
# First, replace 0 values with an estimate (because normalization is taking log, can't have 0)
# Also transposing here, need samples as rows
d.czm <- cmultRepl(t(otu), method="CZM", label=0, z.warning=1)
# Perform the center-log-ratio (CLR) transformation
d.clr <- codaSeq.clr(d.czm)
# transpose matrix of CLR transformed data for ordination and dendrogram
E.clr <- t(d.clr)
# plot compositional PCA biplot (perform a singular value decomposition)
d.pcx <- prcomp(E.clr)
# calculate percent variance explained for the axis labels
pc1 <- round(d.pcx$sdev[1]^2/sum(d.pcx$sdev^2),2)
pc2 <- round(d.pcx$sdev[2]^2/sum(d.pcx$sdev^2),2)
xlab <- paste("PC1: ", pc1, sep="")
ylab <- paste("PC2: ", pc2, sep="")
#biplot(d.pcx, cex=c(0.6,0.4), var.axes=F,scale=1, xlab=xlab, ylab=ylab)
summary(d.pcx)
str(d.pcx)
screeplot(d.pcx)
# Make a pretty PCA plot with ggplot
df_out <- as.data.frame(d.pcx$x)
theme_set(theme_bw()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank()))
cols<-c("before"="#6CD5D9","after"="#107A86")
samples$type<-factor(samples$type, levels=c("before","after"))
#pdf("PCA.pdf",bg ="white",width=8.5)
p<-ggplot(df_out,aes(x=PC1,y=PC2,fill=samples$type,shape=samples$fraction))
p<-p+geom_point(size=3)+
theme(axis.title = element_text(size=14))+
theme(axis.text=element_text(size=12))+
theme(legend.title = element_text(size=14))+
theme(legend.text = element_text(size=12))+
scale_shape_manual(values=c(21,22))+
scale_fill_manual(values=cols)+
guides(fill = guide_legend(override.aes=list(shape=21)))+
facet_grid(~samples$fraction)
p + labs(x=xlab, y=ylab, fill="Type",shape="Fraction") +coord_fixed()
#dev.off()
####### Use phyloseq/vegan to perform PERMANOVA
# set metadata as factors
type<-as.character(samples$type)
frac<-as.character(samples$fraction)
# permanova between groups using Aitchison distance
dist.clr <- dist(E.clr)
perm<-adonis2(dist.clr~type*frac,as(sample_data(ps),"data.frame"),by="terms")
print(perm)
ps
# load in data and create phyloseq object
otu <- read.table("silva_nochloronomito_otu_table_ps5.txt",sep="\t",header=TRUE, row.names=1)
taxon <- read.table("silva_nochloronomito_taxa_table_ps5.txt",sep="\t",header=TRUE,row.names=1)
samples<-read.table("metadata_ps5.txt",sep="\t",header=T,row.names=1)
OTU = otu_table(otu, taxa_are_rows=FALSE)
taxon<-as.matrix(taxon)
TAX = tax_table(taxon)
sampledata = sample_data(samples)
ps <- phyloseq(otu_table(otu, taxa_are_rows=FALSE),
sample_data(samples),
tax_table(taxon))
ps #112 taxa and 35 samples
ps_ra<-transform_sample_counts(ps, function(OTU) OTU/sum(OTU))
get_taxa_unique(ps_ra, "Class") #19
get_taxa_unique(ps_ra, "Order") #37
get_taxa_unique(ps_ra, "Family") #53
get_taxa_unique(ps_ra, "Genus") #61
sample_data(ps_ra)$type<-factor(sample_data(ps_ra)$type, levels=c("before","after"))
n <- 19
# after plotting, you can re-run the next line to create a different selection of colors
palette <- distinctColorPalette(n)
#pdf("barchart_Class.pdf",width=11)
p1=plot_bar(ps_ra, "colony" ,fill="Class")+
facet_grid(fraction~type,scales="free",space="free")+
geom_bar(aes(fill=Class), stat="identity",position="stack")+
theme_bw()+
theme(strip.text=element_text(face="bold", size=12))+
theme(axis.text.x=element_text(size=12))+
theme(axis.text.y=element_text(size=12))+
scale_fill_manual(values=palette)+
#theme(axis.title.x = element_blank())+
theme(legend.position = "bottom")
p1
#dev.off()
n <- 37
palette <- distinctColorPalette(n)
#pdf("barchart_Order.pdf",width=11)
p1=plot_bar(ps_ra, "colony" ,fill="Order")+
facet_grid(fraction~type,scales="free",space="free")+
geom_bar(aes(fill=Order), stat="identity",position="stack")+
theme_bw()+
theme(strip.text=element_text(face="bold", size=12))+
theme(axis.text.x=element_text(size=12))+
theme(axis.text.y=element_text(size=12))+
scale_fill_manual(values=palette)+
#theme(axis.title.x = element_blank())+
theme(legend.position = "bottom")
p1
#dev.off()
n <- 53
palette <- distinctColorPalette(n)
#pdf("barchart_Family.pdf",width=11)
p1=plot_bar(ps_ra, "colony" ,fill="Family")+
facet_grid(fraction~type,scales="free",space="free")+
geom_bar(aes(fill=Family), stat="identity",position="stack")+
theme_bw()+
theme(strip.text=element_text(face="bold", size=12))+
theme(axis.text.x=element_text(size=12))+
theme(axis.text.y=element_text(size=12))+
scale_fill_manual(values=palette)+
#theme(axis.title.x = element_blank())+
theme(legend.position = "bottom")
p1
#dev.off()
n <- 61
palette <- distinctColorPalette(n)
#pdf("barchart_Genus.pdf",width=11)
p1=plot_bar(ps_ra, "colony" ,fill="Genus")+
facet_grid(fraction~type,scales="free",space="free")+
geom_bar(aes(fill=Genus), stat="identity",position="stack")+
theme_bw()+
theme(strip.text=element_text(face="bold", size=12))+
theme(axis.text.x=element_text(size=12))+
theme(axis.text.y=element_text(size=12))+
scale_fill_manual(values=palette)+
#theme(axis.title.x = element_blank())+
theme(legend.position = "bottom")
p1
#dev.off()
# use an ASV table that has been filtered to remove low-abundance ASVs, no blanks
otu <- read.table("silva_nochloronomito_otu_table_ps5.txt",sep="\t",header=TRUE, row.names=1)
taxon <- read.table("silva_nochloronomito_taxa_table_ps5.txt",sep="\t",header=TRUE,row.names=1)
samples<-read.table("metadata_ps5.txt",sep="\t",header=T,row.names=1)
OTU = otu_table(otu, taxa_are_rows=FALSE)
taxon<-as.matrix(taxon)
TAX = tax_table(taxon)
sampledata = sample_data(samples)
ps <- phyloseq(otu_table(otu, taxa_are_rows=FALSE),
sample_data(samples),
tax_table(taxon))
ps # 112 taxa and 35 samples
# DA determined relative to first reference level. The default in R is alphabetical order, but I want to compare taxa "after" relative to "before", so I need to manually state the order of input.
sample_data(ps)$type<-factor(sample_data(ps)$type,levels=c("before","after"))
# You can verify the change by checking:
levels(sample_data(ps)$type)
# I will also control for nucleic acid fraction since they are so different in composition
set.seed(1)
treatment.da <- differentialTest(formula = ~ type + fraction,
phi.formula = ~ type,
formula_null = ~ fraction,
phi.formula_null = ~ 1,
test = "Wald", boot = FALSE,
data = ps,
fdr_cutoff = 0.05)
summary(treatment.da)
treatment.da
treatment.da$significant_taxa
plot(treatment.da, c("Family", "Genus"))
# results: 1 significant ASV classified as Pseudomonas - that was lower abundance after treatment
# Start by creating phyloseq object using full dataset (low abundance ASVs are not removed).
otu <- read.table("silva_nochloronomito_otu_table_ps1.txt",sep="\t",header=TRUE, row.names=1)
taxon <- read.table("silva_nochloronomito_taxa_table_ps1.txt",sep="\t",header=TRUE,row.names=1)
samples<-read.table("metadata_ps1.txt",sep="\t",header=T,row.names=1)
OTU = otu_table(otu, taxa_are_rows=FALSE)
taxon<-as.matrix(taxon)
TAX = tax_table(taxon)
sampledata = sample_data(samples)
ps1 <- phyloseq(otu_table(otu, taxa_are_rows=FALSE),
sample_data(samples),
tax_table(taxon))
ps1 #6138 taxa and 35 samples
# prune empty rows
ps_qf <- prune_taxa(taxa_sums(ps1) > 1, ps1)
ps_qf # 1853 taxa and 35 samples
# ANCOM-BC2 results will be expressed as a relative relationship - it will test variables in the order that they are input. The default in R is alphabetical order, but I want to compare taxa "after" relative to "before", so I need to manually state the order of input.
sample_data(ps_qf)$type<-factor(sample_data(ps_qf)$type,levels=c("before","after"))
# You can verify the change by checking:
levels(sample_data(ps_qf)$type)
set.seed(123)
output = ancombc2(data = ps_qf, assay_name = "counts", tax_level = "Genus",
fix_formula = "fraction + type", rand_formula = NULL,
p_adj_method = "holm", pseudo = 0, pseudo_sens = TRUE,
prv_cut = 0.10, lib_cut = 1000, s0_perc = 0.05,
group = "type", struc_zero = FALSE, neg_lb = FALSE,
alpha = 0.05, n_cl = 2, verbose = TRUE,
global = FALSE, pairwise = FALSE,
dunnet = FALSE, trend = FALSE,
iter_control = list(tol = 1e-5, max_iter = 20,
verbose = FALSE),
em_control = list(tol = 1e-5, max_iter = 100),
lme_control = NULL, mdfdr_control = NULL,
trend_control = NULL)
res_prim = output$res
print(res_prim)
# nothing significantly different after treatment relative to before (column "diff_typeafter"=TRUE AND column "passed_ss_typeafter"=TRUE); One ASV was likely a false positive (column "diff_typeafter"=TRUE AND column "passed_ss_typeafter"=FALSE)
ps_dna <- subset_samples(ps_qf, fraction == "DNA")
ps_dna # 1853 taxa and 18 samples
# prune empty rows
ps_dna_qf <- prune_taxa(taxa_sums(ps_dna) > 1, ps_dna)
ps_dna_qf # 1170 taxa and 18 samples
sample_data(ps_dna_qf)$type<-factor(sample_data(ps_dna_qf)$type,levels=c("before","after"))
# You can verify the change by checking:
levels(sample_data(ps_dna_qf)$type)
set.seed(123)
output = ancombc2(data = ps_dna_qf, assay_name = "counts", tax_level = "Genus",
fix_formula = "type", rand_formula = NULL,
p_adj_method = "holm", pseudo = 0, pseudo_sens = TRUE,
prv_cut = 0.10, lib_cut = 1000, s0_perc = 0.05,
group = "type", struc_zero = FALSE, neg_lb = FALSE,
alpha = 0.05, n_cl = 2, verbose = TRUE,
global = FALSE, pairwise = FALSE,
dunnet = FALSE, trend = FALSE,
iter_control = list(tol = 1e-5, max_iter = 20,
verbose = FALSE),
em_control = list(tol = 1e-5, max_iter = 100),
lme_control = NULL, mdfdr_control = NULL,
trend_control = NULL)
res_prim_dna = output$res
print(res_prim_dna)
# nothing significantly different after treatment relative to before (all taxa are FALSE for column "diff_typeafter")
# Subset and test RNA fraction
ps_qf # 1853 taxa and 35 samples
ps_qf # 1853 taxa and 35 samples
ps_dna_qf # 1170 taxa and 18 samples
sample_data(ps_dna_qf)$type<-factor(sample_data(ps_dna_qf)$type,levels=c("before","after"))
# You can verify the change by checking:
levels(sample_data(ps_dna_qf)$type)
set.seed(123)
output = ancombc2(data = ps_dna_qf, assay_name = "counts", tax_level = "Genus",
fix_formula = "type", rand_formula = NULL,
p_adj_method = "holm", pseudo = 0, pseudo_sens = TRUE,
prv_cut = 0.10, lib_cut = 1000, s0_perc = 0.05,
group = "type", struc_zero = FALSE, neg_lb = FALSE,
alpha = 0.05, n_cl = 2, verbose = TRUE,
global = FALSE, pairwise = FALSE,
dunnet = FALSE, trend = FALSE,
iter_control = list(tol = 1e-5, max_iter = 20,
verbose = FALSE),
em_control = list(tol = 1e-5, max_iter = 100),
lme_control = NULL, mdfdr_control = NULL,
trend_control = NULL)
res_prim_dna = output$res
print(res_prim_dna)
# Subset and test RNA fraction
ps_qf # 1857 taxa and 35 samples
ps_rna <- subset_samples(ps_qf, fraction == "RNA")
# Start by creating phyloseq object using full dataset (low abundance ASVs are not removed).
otu <- read.table("silva_nochloronomito_otu_table_ps1.txt",sep="\t",header=TRUE, row.names=1)
taxon <- read.table("silva_nochloronomito_taxa_table_ps1.txt",sep="\t",header=TRUE,row.names=1)
samples<-read.table("metadata_ps1.txt",sep="\t",header=T,row.names=1)
OTU = otu_table(otu, taxa_are_rows=FALSE)
taxon<-as.matrix(taxon)
TAX = tax_table(taxon)
sampledata = sample_data(samples)
ps1 <- phyloseq(otu_table(otu, taxa_are_rows=FALSE),
sample_data(samples),
tax_table(taxon))
ps1 #6138 taxa and 35 samples
# prune empty rows
ps_qf <- prune_taxa(taxa_sums(ps1) > 1, ps1)
ps_qf # 1857 taxa and 35 samples
# Subset and test RNA fraction
ps_qf # 1857 taxa and 35 samples
ps_rna <- subset_samples(ps_qf, fraction == "RNA")
View(samples)
View(sampledata)
# Start by creating phyloseq object using full dataset (low abundance ASVs are not removed).
otu <- read.table("silva_nochloronomito_otu_table_ps1.txt",sep="\t",header=TRUE, row.names=1)
taxon <- read.table("silva_nochloronomito_taxa_table_ps1.txt",sep="\t",header=TRUE,row.names=1)
samples<-read.table("metadata_ps1.txt",sep="\t",header=T,row.names=1)
OTU = otu_table(otu, taxa_are_rows=FALSE)
taxon<-as.matrix(taxon)
TAX = tax_table(taxon)
sampledata = sample_data(samples)
ps1 <- phyloseq(otu_table(otu, taxa_are_rows=FALSE),
sample_data(samples),
tax_table(taxon))
ps1 #6138 taxa and 35 samples
# prune empty rows
ps_qf <- prune_taxa(taxa_sums(ps1) > 1, ps1)
ps_qf # 1857 taxa and 35 samples
# Subset and test RNA fraction
ps_qf # 1857 taxa and 35 samples
ps_rna <- subset_samples(ps_qf, fraction == "RNA")
View(samples)
View(sampledata)
View(samples)
# Start by creating phyloseq object using full dataset (low abundance ASVs are not removed).
otu <- read.table("silva_nochloronomito_otu_table_ps1.txt",sep="\t",header=TRUE, row.names=1)
taxon <- read.table("silva_nochloronomito_taxa_table_ps1.txt",sep="\t",header=TRUE,row.names=1)
samples<-read.table("metadata_ps1.txt",sep="\t",header=T,row.names=1)
OTU = otu_table(otu, taxa_are_rows=FALSE)
taxon<-as.matrix(taxon)
TAX = tax_table(taxon)
sampledata = sample_data(samples)
ps1 <- phyloseq(otu_table(otu, taxa_are_rows=FALSE),
sample_data(samples),
tax_table(taxon))
ps1 #6138 taxa and 35 samples
# prune empty rows
ps_qf <- prune_taxa(taxa_sums(ps1) > 1, ps1)
ps_qf # 1857 taxa and 35 samples
# Subset and test RNA fraction
ps_qf # 1857 taxa and 35 samples
ps_rna <- subset_samples(ps_qf, fraction == "RNA")
ps_rna # 1857 taxa and 17 samples
# prune empty rows
ps_rna_qf <- prune_taxa(taxa_sums(ps_rna) > 1, ps_rna)
ps_rna_qf # 888 taxa and 17 samples
sample_data(ps_rna_qf)$type<-factor(sample_data(ps_rna_qf)$type,levels=c("before","after"))
# You can verify the change by checking:
levels(sample_data(ps_rna_qf)$type)
set.seed(123)
output = ancombc2(data = ps_rna_qf, assay_name = "counts", tax_level = "Genus",
fix_formula = "type", rand_formula = NULL,
p_adj_method = "holm", pseudo = 0, pseudo_sens = TRUE,
prv_cut = 0.10, lib_cut = 1000, s0_perc = 0.05,
group = "type", struc_zero = FALSE, neg_lb = FALSE,
alpha = 0.05, n_cl = 2, verbose = TRUE,
global = FALSE, pairwise = FALSE,
dunnet = FALSE, trend = FALSE,
iter_control = list(tol = 1e-5, max_iter = 20,
verbose = FALSE),
em_control = list(tol = 1e-5, max_iter = 100),
lme_control = NULL, mdfdr_control = NULL,
trend_control = NULL)
res_prim_rna = output$res
print(res_prim_rna)
# nothing significantly different after treatment relative to before (all taxa are FALSE for column "diff_typeafter")
View(res_prim_rna)
get_taxa_unique(ps_ra, "Class") #19
ps #112 taxa and 35 samples
otu <- read.table("silva_nochloronomito_otu_table_ps5.txt",sep="\t",header=TRUE, row.names=1)
taxon <- read.table("silva_nochloronomito_taxa_table_ps5.txt",sep="\t",header=TRUE,row.names=1)
samples<-read.table("metadata_ps5.txt",sep="\t",header=T,row.names=1)
OTU = otu_table(otu, taxa_are_rows=FALSE)
taxon<-as.matrix(taxon)
TAX = tax_table(taxon)
sampledata = sample_data(samples)
ps <- phyloseq(otu_table(otu, taxa_are_rows=FALSE),
sample_data(samples),
tax_table(taxon))
ps
ps_ra<-transform_sample_counts(ps, function(OTU) OTU/sum(OTU))
get_taxa_unique(ps_ra, "Class") #19
get_taxa_unique(ps_ra, "Order") #37
get_taxa_unique(ps_ra, "Family") #53
get_taxa_unique(ps_ra, "Genus") #61
sample_data(ps_ra)$type<-factor(sample_data(ps_ra)$type, levels=c("before","after"))
# load in data and create phyloseq object
otu <- read.table("silva_nochloronomito_otu_table_ps5.txt",sep="\t",header=TRUE, row.names=1)
taxon <- read.table("silva_nochloronomito_taxa_table_ps5.txt",sep="\t",header=TRUE,row.names=1)
samples<-read.table("metadata_ps5.txt",sep="\t",header=T,row.names=1)
OTU = otu_table(otu, taxa_are_rows=FALSE)
taxon<-as.matrix(taxon)
TAX = tax_table(taxon)
sampledata = sample_data(samples)
ps <- phyloseq(otu_table(otu, taxa_are_rows=FALSE),
sample_data(samples),
tax_table(taxon))
ps #112 taxa and 35 samples
ps_ra<-transform_sample_counts(ps, function(OTU) OTU/sum(OTU))
get_taxa_unique(ps_ra, "Class") #19
get_taxa_unique(ps_ra, "Order") #38
get_taxa_unique(ps_ra, "Family") #53
get_taxa_unique(ps_ra, "Genus") #61
sample_data(ps_ra)$type<-factor(sample_data(ps_ra)$type, levels=c("before","after"))
n <- 19
# after plotting, you can re-run the next line to create a different selection of colors
palette <- distinctColorPalette(n)
#pdf("barchart_Class.pdf",width=11)
p1=plot_bar(ps_ra, "colony" ,fill="Class")+
facet_grid(fraction~type,scales="free",space="free")+
geom_bar(aes(fill=Class), stat="identity",position="stack")+
theme_bw()+
theme(strip.text=element_text(face="bold", size=12))+
theme(axis.text.x=element_text(size=12))+
theme(axis.text.y=element_text(size=12))+
scale_fill_manual(values=palette)+
#theme(axis.title.x = element_blank())+
theme(legend.position = "bottom")
p1
#dev.off()
n <- 38
palette <- distinctColorPalette(n)
#pdf("barchart_Order.pdf",width=11)
p1=plot_bar(ps_ra, "colony" ,fill="Order")+
facet_grid(fraction~type,scales="free",space="free")+
geom_bar(aes(fill=Order), stat="identity",position="stack")+
theme_bw()+
theme(strip.text=element_text(face="bold", size=12))+
theme(axis.text.x=element_text(size=12))+
theme(axis.text.y=element_text(size=12))+
scale_fill_manual(values=palette)+
#theme(axis.title.x = element_blank())+
theme(legend.position = "bottom")
p1
#dev.off()
n <- 53
palette <- distinctColorPalette(n)
#pdf("barchart_Family.pdf",width=11)
p1=plot_bar(ps_ra, "colony" ,fill="Family")+
facet_grid(fraction~type,scales="free",space="free")+
geom_bar(aes(fill=Family), stat="identity",position="stack")+
theme_bw()+
theme(strip.text=element_text(face="bold", size=12))+
theme(axis.text.x=element_text(size=12))+
theme(axis.text.y=element_text(size=12))+
scale_fill_manual(values=palette)+
#theme(axis.title.x = element_blank())+
theme(legend.position = "bottom")
p1
#dev.off()
n <- 61
palette <- distinctColorPalette(n)
#pdf("barchart_Genus.pdf",width=11)
p1=plot_bar(ps_ra, "colony" ,fill="Genus")+
facet_grid(fraction~type,scales="free",space="free")+
geom_bar(aes(fill=Genus), stat="identity",position="stack")+
theme_bw()+
theme(strip.text=element_text(face="bold", size=12))+
theme(axis.text.x=element_text(size=12))+
theme(axis.text.y=element_text(size=12))+
scale_fill_manual(values=palette)+
#theme(axis.title.x = element_blank())+
theme(legend.position = "bottom")
p1
#dev.off()
